<ng-container *ngIf="loading">
   <div class="align-content-center mt-5" style="height: calc(100vh - 116px);">
      <div class="flex flex-column align-items-center justify-content-center text-center">
         <i class="pi pi-spin pi-spinner font-semibold text-4xl text-primary-500"></i>
         <h2 class="text-lg font-medium text-600">{{ loadingMsg }}</h2>
      </div>
   </div>
</ng-container>

<ng-container *ngIf="!loading">
   <div class="p-dialog-header fixed w-full" style="background-color: #742284; padding: 0.75rem 0.5rem;">
      <div class="flex align-items-center gap-2">
         <div (click)="onClose()" type="button" class="p-dialog-button">
            <i class="pi pi-chevron-left"></i>
         </div>
         <span class="text-white font-bold">MÉTODOS DE PAGO</span>
      </div>
   </div>

   <div *ngIf="paymentStatus === 'PENDING'" class="text-center p-5 mt-5">
      <section style="color: #000; !important">
         <h2 class="text-xl font-bold mb-2">{{ tituloPlan }}</h2>

         <div class="bg-yellow-400 p-3 border-round mb-3 font-semibold">
            <img [src]="logoPagoEfectivo" alt="pagoefectivo" width="150" height="20">
            <div class="text-sm mt-1 font-normal">Información para tu pago</div>
         </div>

         <p class="font-medium mb-3">
            ¡Estás a punto de finalizar tu compra!
         </p>

         <div class="border-1 border-300 border-round p-3 mb-3 text-center text-xs">
            <p class="m-0"><strong>Empresa:</strong> PagoEfectivo</p>
            <p class="m-0"><strong>Servicio:</strong> PagoEfectivo Soles</p>
         </div>

         <div class="bg-yellow-400 border-round p-3 mb-3">
            <p class="text-sm m-0">Código de pago</p>

            <div class="flex justify-content-center align-items-center mb-1">
               <h1 class="text-3xl font-bold m-0">{{ cip }}</h1>
            </div>

            <div class="flex justify-content-center">
               <button (click)="onCopiarPortapapeles()" [ngClass]="{ 'bg-yellow-300': copiado }"
                  style="background-color:#fbbf2499"
                  class="pointer border-round-sm border-gray-600 border-1 px-2 py-1 flex align-items-center gap-2">
                  <i class="pi pi-copy text-yellow-900"></i>
                  <span>{{ copiado ? '¡Copiado!' : 'Copiar' }}</span>
               </button>
            </div>
         </div>


         <div class="bg-gray-100 border-round p-3 mb-4">
            <p class="text-sm m-0">Monto a pagar</p>
            <h2 class="text-2xl font-semibold m-0">{{ amount | currency }}</h2>
         </div>
      </section>

      <ng-container>
         <section class="text-left mb-5">
            <p class="font-semibold mb-2">Puedes pagar en:</p>
            <div class="flex flex-wrap gap-2 justify-content-center">
               <ng-container *ngFor="let item of bancos">
                  <img [src]="item.img" [alt]="item.name" width="70">
               </ng-container>
            </div>
         </section>
         <section class="text-left mb-5">
            <p class="font-semibold mb-2">Instrucciones de pago:</p>
            <div class="px-3">
               <ol class="text-sm m-0 p-0">
                  <li>Selecciona la opción <strong>Pago de Servicios</strong></li>
                  <li>Busca y selecciona la institución/empresa <strong>PAGOEFECTIVO</strong></li>
                  <li>Selecciona <strong>PAGOEFECTIVO SOLES</strong></li>
                  <li>Ingresa tu código CIP: <strong>{{ cip }}</strong> y sigue los pasos.</li>
               </ol>
            </div>
         </section>
         <section>
            <p class="font-semibold mb-2">¿Aun no tienes acceso?</p>
            <p class="text-sm m-0 mb-2">
               Si ya realizaste el pago y aún no tienes acceso, asegúrate de tener conexión a internet.<br><br>
               El acceso <strong class="text-yape">se activa en tu dispositivo automáticamente</strong> una vez se
               valida el pago, lo cual puede tardar hasta 1 minuto. <br><br>
               Cierra la aplicación y vuelve a abrirla para que se refleje el cambio.
               Si el problema persiste, haz clic en el siguiente botón:
            </p>
            <div class="mb-3">
               <a [href]="linkSoporte" target="_blank" class="px-1 py-3 flex gap-3" pButton icon="pi pi-headphones"
                  label="Soporte" size="small">
               </a>
            </div>
         </section>
         <section class="mb-3">
            <p class="font-semibold mb-2">¡Importante!</p>
            <p class="text-sm m-0">
               Recuerda que este servicio se activa con un solo pago. Una vez realizado, el acceso es permanente y no
               requiere pagos mensuales ni renovaciones.
            </p>
         </section>
      </ng-container>
   </div>
   <div *ngIf="paymentStatus === 'PAID'" class="text-center p-5 mt-5">
      <div class="bg-green-100 border-round p-3 mt-3">
         <div class="py-5 my-5">
            <h3 class="text-green-800 text-xl font-semibold">✅ ¡Pago Confirmado!</h3>
            <p class="text-green-700">Tu acceso permanente está activo. ¡Gracias por tu confianza!</p><br>
            <p class="text-green-700">Para visualizar los cambios, cierra sesión y vuelve a ingresar.</p>
         </div>
      </div>
   </div>
</ng-container>
