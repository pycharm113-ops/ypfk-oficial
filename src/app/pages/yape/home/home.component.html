<div *ngIf="!showCaptura && !showEscanner" class="select-none">
   <div class="flex flex-column justify-content-between" style="min-height: 100vh;">
      <div class="bg-yape pb-2">
         <div class="w-full fixed fixed-header" [ngClass]="showSearch ? 'bg-fixed1' : 'bg-fixed2'">
            <div class=" py-3 px-4 flex align-items-center justify-content-between text-white ">
               <a routerLink="/config" class="pointer tourid-0">
                  <img src="font-icons/user.svg" alt="" width="22">
               </a>
               <div class="flex align-items-center gap-2" style="width: 175px;">
                  <span class="text-bold truncate-text">Hola, {{ profile.titular }}</span>
                  <p-badge value="Gratis" severity="warn" styleClass="py-1 px-2 p-badge-xs" />
               </div>
               <div class="flex align-items-center gap-2">
                  <img src="font-icons/headphones.svg" alt="" width="21" height="21">
                  <img src="font-icons/bell.svg" alt="" width="24" height="24">
               </div>
            </div>
            <div *ngIf="showSearch" class="px-3 pb-2">
               <div class="flex align-items-center p-2 border-round-3xl w-full max-w-30rem"
                  style="background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
                  <div class="flex align-items-center justify-content-center"
                     style="background: #f7ebfb; width: 2rem; height: 2rem; border-radius: 50%;">
                     <i class="font-semibold pi pi-search"></i>
                  </div>
                  <span class="ml-3 text-400 text-sm">Buscar en Yape</span>
               </div>
            </div>
         </div>
         <div *ngIf="showSearch" style="height: 114px;"></div>
         <div *ngIf="!showSearch" style="height: 50px;"></div>
         <div class="relative grid mx-3 mt-1">
            <div *ngIf="userfreeClient && product" class="watermark-link-wrapper">
               <a (click)="onYapePlanes()" class="watermark-link" rel="noopener">
                  <div class="text-red-500 underline">
                     CLICK AQUÍ PARA QUITAR <br>LA MARCA DE AGUA
                  </div>
                  <div>
                     PAGO ÚNICO DE {{ product.price }} SOLES <br> ACCESO PERMANENTE <br> SIN PLANES
                  </div>
               </a>
            </div>
            <ng-container *ngFor="let item of icons; let last = last; let i = index">
               <div *ngIf="item.visible" class="col-3 px-1">
                  <div class="icon-item flex flex-column align-items-center text-center">
                     <div class="relative">
                        <div *ngIf="item?.badge" class="absolute" style="right: -25%; top: -13px;">
                           <p-badge [value]="item.badge" severity="warn" styleClass="px-1 p-badge-xs p-badge-b" />
                        </div>
                        <div class="flex align-items-center mb-1"
                           [ngClass]="{'bg-white p-2 border-round-icons': !last}">
                           <img [attr.draggable]="false" [src]="item.img" [width]="last ? 50 : 34"
                              [height]="last ? 50 : 34" />
                        </div>
                     </div>
                     <span class="text-xs text-white font-medium">{{ item.text }}</span>
                  </div>
               </div>
            </ng-container>
         </div>
         <div class="pl-3 pt-1">
            <ng-container *ngIf="loading">
               <div class="flex gap-3 overflow-hidden">
                  <p-skeleton width="235px" height="105px" styleClass="border-round-2xl flex-shrink-0" />
                  <p-skeleton width="235px" height="105px" styleClass="border-round-2xl flex-shrink-0" />
               </div>
               <div style="height: 9px;"></div>
            </ng-container>
            <p-carousel [value]="publicidad" [numVisible]="1" [numScroll]="1" [circular]="true"
               [autoplayInterval]="4000" [showNavigators]="false" [page]="0" (onPage)="onCarouselPageChange($event)">
               <ng-template let-item pTemplate="item">
                  <div class="carousel-item">
                     <img [src]="item.img" [attr.draggable]="false" [alt]="item.text" class="carousel-img" />
                     <div class="preview-img-container" *ngIf="getNextImg(item) as nextImg"
                        [class.show]="shouldShowPeek(item)">
                        <img [src]="nextImg" [attr.draggable]="false" class="preview-img" />
                     </div>
                  </div>
               </ng-template>
            </p-carousel>
         </div>
      </div>
      <div style="background-color: #4a1972;" class="flex-1 flex flex-column">
         <div class="bg-white border-round-top-2xl flex-1">
            <div class="p-3 text-sm">
               <div (click)="onMostrarSaldo()"
                  class="pointer flex justify-content-between border-round-md shadow-2 text-yape p-3 mb-2 tourid-7">
                  <div class="font-medium flex align-items-center gap-2">
                     <img [src]="showSaldo ?'font-icons/eye-close.svg': 'font-icons/eye-open.svg'" width="20px">
                     <span>Mostrar saldo</span>
                  </div>
                  <div class="font-medium align-content-center">
                     <ng-container *ngIf="showSaldo && !loadSaldo">
                        <span class="align-content-center" style="color: #2C2044;">
                           {{ (profile.saldo || 0) | currency }}
                        </span>
                     </ng-container>
                     <ng-container *ngIf="loadSaldo">
                        <i class="pi pi-spin pi-spinner font-semibold"></i>
                     </ng-container>
                  </div>
               </div>
               <div class="border-round-md shadow-2 text-yape">
                  <div (click)="onMostrarMovimientos()" class="pointer flex justify-content-between p-3 tourid-8">
                     <div class="font-medium flex align-items-center gap-2">
                        <img src="font-icons/movements.svg" width="20px">
                        <span>Mostrar movimientos</span>
                     </div>
                     <div style="color: #A19DAA;">
                        <i class="pi mr-2" [ngClass]="showMovimiento ? 'pi-angle-up':'pi-angle-down'"></i>
                     </div>
                  </div>
                  <div *ngIf="showMovimiento" class="slide-down px-3 pb-3">
                     <ng-container *ngFor="let item of movimientos; let first = first">
                        <div (click)="onVerVoucher(item)" (touchstart)="onTouchStart($event, item)"
                           (touchmove)="onTouchMove($event)" (touchend)="onTouchEnd($event)"
                           [style.transform]="'translateX(' + (currentTranslateX.get(item) || 0) + 'px)'"
                           [@fadeOut]="fadingItems.has(item) ? 'hidden' : 'visible'" [class.pt-0]="first"
                           [class.pt-2]="!first"
                           class="flex justify-content-between text-secondary border-bottom-1 border-gray-300 pb-2"
                           style="overflow: hidden; touch-action: pan-y; position: relative;">
                           <ng-container *ngIf="loadMovimiento">
                              <div class="flex flex-column gap-2">
                                 <p-skeleton width="10rem" height="0.7rem" />
                                 <p-skeleton width="4rem" height="0.7rem" />
                              </div>
                              <p-skeleton width="3rem" height="0.7rem" />
                           </ng-container>
                           <ng-container *ngIf="!loadMovimiento">
                              <div>
                                 <div class="truncate-text font-medium mb-1" style="max-width: 200px;">
                                    <ng-container *ngIf="!item.recarga" [ngSwitch]="item.destino">
                                       <ng-container *ngSwitchCase="'Yape'">
                                          <span>{{ item.titular }}</span>
                                       </ng-container>
                                       <ng-container *ngSwitchCase="'Izipay'">
                                          <span>{{ item.titular }}</span>
                                       </ng-container>
                                       <ng-container *ngSwitchDefault>
                                          {{ item.destino }} - <span>{{ item.titular }}</span>
                                       </ng-container>
                                    </ng-container>
                                    <ng-container *ngIf="item.recarga">
                                       <span>Recarga a {{ item.celularMask }}</span>
                                    </ng-container>
                                 </div>
                                 <span class="font-sm" style="color: #8C8699;">{{ item.fechaAgo }}</span>
                              </div>
                              <div class="align-content-center font-medium"
                                 [ngClass]="item.montoAgo >= 0 ? 'text-secondary' : 'text-red-500'">
                                 {{ item.montoAgo | currency }}
                              </div>
                           </ng-container>
                        </div>
                     </ng-container>
                     <ng-container *ngIf="movimientos.length === 0">
                        <div class="text-center text-xs text-500 py-2">No se encontraron movimientos</div>
                     </ng-container>
                     <div *ngIf="movimientos.length > 0" class="text-center font-medium text-primary pt-3">
                        VER TODOS
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div style="height: 83px;"></div>
      <div class="app-container fixed bg-white w-full bottom-0 top-shadow p-3">
         <div class="flex gap-2">
            <button (click)="onEscanear()" pButton size="small"
               class="w-full font-semibold py-3 p-button-outlined tourid-9">
               <img src="font-icons/qr.webp" width="18"> ESCANEAR QR
            </button>
            <button pButton routerLink="/search" size="small" class="w-full font-semibold py-3 tourid-10">
               <img src="font-icons/send.webp" width="18"> YAPEAR
            </button>
         </div>
      </div>
   </div>
</div>

<app-voucher *ngIf="showCaptura && !showEscanner" [data]="data" [isMovimiento]="true" (cerrar)="onRetornar()">
</app-voucher>

<div *ngIf="showEscanner">
   <app-scanner (cerrar)="onRetornar()"></app-scanner>
</div>

<ng-container *ngIf="viewYapePlanes">
   <p-dialog [(visible)]="viewYapePlanes" [modal]="true" styleClass="p-dialog-menu">
      <ng-template pTemplate="header">
         <div class="flex align-items-center gap-2">
            <div (click)="viewYapePlanes = false" type="button" class="flex justify-content-center align-items-center"
               style="width: 2.5rem; height: 2.5rem;">
               <i class="pi pi-chevron-left text-white text-lg"></i>
            </div>
            <span class="text-white font-bold">PRODUCTOS</span>
         </div>
      </ng-template>
      <app-paquetes></app-paquetes>
   </p-dialog>
</ng-container>
